<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Craft</title>
  </head>
  <body>
    <style>
      #blocker {
        position: absolute;
        width: 100%;
        height: 100%;
        background-color: rgba(0,0,0,0.5);
      }

      #instructions {
        width: 100%;
        height: 100%;

        text-align: center;
        padding-top: 50px;

        color: #ffffff;
        text-align: center;
        font-family: Arial;
        font-size: 14px;
        line-height: 24px;

        cursor: pointer;
      }
    </style>
    <div id="blocker">
      <div id="instructions">
        <span style="font-size:36px">Click to play</span>
        <br /><br />
        Move: WASD<br/>
        Jump: SPACE<br/>
        Look: MOUSE
      </div>
    </div>
    <script type="module">
import * as THREE from 'https://threejsfundamentals.org/threejs/resources/threejs/r122/build/three.module.js';
import {PointerLockControls} from 'https://threejsfundamentals.org/threejs/resources/threejs/r122/examples/jsm/controls/PointerLockControls.js';

let camera, scene, renderer, controls;

const objects = [];

let raycaster;

let moveForward = false;
let moveBackward = false;
let moveLeft = false;
let moveRight = false;
let canJump = false;

let prevTime = performance.now();
const velocity = new THREE.Vector3();
const direction = new THREE.Vector3();
const vertex = new THREE.Vector3();
const color = new THREE.Color();

init();
animate();

function init() {
  camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 1, 1000 );
  camera.position.y = 10;

  scene = new THREE.Scene();
  scene.background = new THREE.Color( 0xffffff );
  scene.fog = new THREE.Fog( 0xffffff, 0, 750 );

  const light = new THREE.HemisphereLight( 0xeeeeff, 0x777788, 0.75 );
  light.position.set( 0.5, 1, 0.75 );
  scene.add( light );

  controls = new PointerLockControls( camera, document.body );

  const blocker = document.getElementById( 'blocker' );
  const instructions = document.getElementById( 'instructions' );

  instructions.addEventListener( 'click', function () {
    controls.lock();
  }, false );

  controls.addEventListener( 'lock', function () {
    instructions.style.display = 'none';
    blocker.style.display = 'none';
  } );

  controls.addEventListener( 'unlock', function () {
    blocker.style.display = 'block';
    instructions.style.display = '';
  } );

  scene.add(controls.getObject());

  const onKeyDown = function ( event ) {

    switch ( event.keyCode ) {

      case 38: // up
      case 87: // w
        moveForward = true;
        break;

      case 37: // left
      case 65: // a
        moveLeft = true;
        break;

      case 40: // down
      case 83: // s
        moveBackward = true;
        break;

      case 39: // right
      case 68: // d
        moveRight = true;
        break;

      case 32: // space
        if ( canJump === true ) velocity.y += 20;
        canJump = false;
        break;

    }

  };

  const onKeyUp = function ( event ) {

    switch ( event.keyCode ) {

      case 38: // up
      case 87: // w
        moveForward = false;
        break;

      case 37: // left
      case 65: // a
        moveLeft = false;
        break;

      case 40: // down
      case 83: // s
        moveBackward = false;
        break;

      case 39: // right
      case 68: // d
        moveRight = false;
        break;

    }

  };

  document.addEventListener( 'keydown', onKeyDown, false );
  document.addEventListener( 'keyup', onKeyUp, false );

  raycaster = new THREE.Raycaster( new THREE.Vector3(), new THREE.Vector3( 0, - 1, 0 ), 0, 10 );

  addCubes()

  renderer = new THREE.WebGLRenderer( { antialias: true } );
  renderer.setPixelRatio( window.devicePixelRatio );
  renderer.setSize( window.innerWidth, window.innerHeight );
  document.body.appendChild( renderer.domElement );
  window.addEventListener( 'resize', onWindowResize, false );

}

function onWindowResize() {
  camera.aspect = window.innerWidth / window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize( window.innerWidth, window.innerHeight );

}

function animate() {
  requestAnimationFrame( animate );

  const time = performance.now();

  if ( controls.isLocked === true ) {

    raycaster.ray.origin.copy( controls.getObject().position );

    const intersections = raycaster.intersectObjects( objects );

    const onObject = intersections.length > 0 && intersections[0].distance <= 2;

    const delta = ( time - prevTime ) / 1000;

    velocity.x -= velocity.x * 10.0 * delta;
    velocity.z -= velocity.z * 10.0 * delta;

    velocity.y -= 9.8 * 5.0 * delta; // 100.0 = mass

    direction.z = Number( moveForward ) - Number( moveBackward );
    direction.x = Number( moveRight ) - Number( moveLeft );
    direction.normalize(); // this ensures consistent movements in all directions

    if ( moveForward || moveBackward ) velocity.z -= direction.z * 30.0 * delta;
    if ( moveLeft || moveRight ) velocity.x -= direction.x * 30.0 * delta;

    if ( onObject === true ) {

      velocity.y = Math.max( 0, velocity.y );
      controls.getObject().position.y = intersections[0].point.y + 2;
      canJump = true;

    }

    controls.moveRight( - velocity.x * delta );
    controls.moveForward( - velocity.z * delta );

    controls.getObject().position.y += ( velocity.y * delta ); // new behavior

    if ( controls.getObject().position.y < 0 ) {

      velocity.y = 0;
      controls.getObject().position.y = 0;

      canJump = true;

    }

  }

  prevTime = time;

  renderer.render( scene, camera );

}



function addCubes() {

  const boxWidth = 1;
  const boxHeight = 1;
  const boxDepth = 1;
  const geometry = new THREE.BoxBufferGeometry(boxWidth, boxHeight, boxDepth);

  const loader = new THREE.TextureLoader();

  function loader_load(url){
    var text = loader.load(url);
    text.magFilter = THREE.NearestFilter;
    text.minFilter = THREE.LinearMipMapLinearFilter;
    return text;
  }

  var materials = [
    new THREE.MeshBasicMaterial({map: loader_load('paper_cutout_3_71859379/assets/minecraft/textures/blocks/log_oak.png')}),
    new THREE.MeshBasicMaterial({map: loader_load('paper_cutout_3_71859379/assets/minecraft/textures/blocks/log_oak.png')}),
    new THREE.MeshBasicMaterial({map: loader_load('paper_cutout_3_71859379/assets/minecraft/textures/blocks/log_oak_top.png')}),
    new THREE.MeshBasicMaterial({map: loader_load('paper_cutout_3_71859379/assets/minecraft/textures/blocks/log_oak_top.png')}),
    new THREE.MeshBasicMaterial({map: loader_load('paper_cutout_3_71859379/assets/minecraft/textures/blocks/log_oak.png')}),
    new THREE.MeshBasicMaterial({map: loader_load('paper_cutout_3_71859379/assets/minecraft/textures/blocks/log_oak.png')}),
  ];

  var cube = new THREE.Mesh(geometry, materials);
  scene.add(cube);
  objects.push(cube);
  cube = new THREE.Mesh(geometry, materials);
  scene.add(cube);
  objects.push(cube);
  cube.position.set(0, 1, 0);
  cube = new THREE.Mesh(geometry, materials);
  scene.add(cube);
  objects.push(cube);
  cube.position.set(0, 2, 0);
  cube = new THREE.Mesh(geometry, materials);
  scene.add(cube);
  objects.push(cube);
  cube.position.set(0, 3, 0);

  function addleaf(x, y, z) {
    cube = new THREE.Mesh(geometry, new THREE.MeshBasicMaterial({
      map: loader_load('paper_cutout_3_71859379/assets/minecraft/textures/blocks/leaves_oak.png'),
      alphaTest: 0.5,
      transparent: true,
      side: THREE.DoubleSide,
    }));
    cube.position.set(x, y, z);
    scene.add(cube);
    objects.push(cube);
  }

  addleaf(0, 4, 0);
  addleaf(0, 5, 0);
  addleaf(0, 6, 0);

  addleaf(1, 4, 0);
  addleaf(-1, 4, 0);
  addleaf(1, 4, 1);
  addleaf(-1, 4, -1);
  addleaf(-1, 4, 1);
  addleaf(1, 4, -1);
  addleaf(0, 4, 1);
  addleaf(0, 4, -1);

  addleaf(1, 5, 0);
  addleaf(-1, 5, 0);
  addleaf(1, 5, 1);
  addleaf(-1, 5, -1);
  addleaf(-1, 5, 1);
  addleaf(1, 5, -1);
  addleaf(0, 5, 1);
  addleaf(0, 5, -1);



  materials = [
    new THREE.MeshBasicMaterial({map: loader_load('paper_cutout_3_71859379/assets/minecraft/textures/blocks/grass_side.png')}),
    new THREE.MeshBasicMaterial({map: loader_load('paper_cutout_3_71859379/assets/minecraft/textures/blocks/grass_side.png')}),
    new THREE.MeshBasicMaterial({map: loader_load('paper_cutout_3_71859379/assets/minecraft/textures/blocks/grass_top.png')}),
    new THREE.MeshBasicMaterial({map: loader_load('paper_cutout_3_71859379/assets/minecraft/textures/blocks/grass_top.png')}),
    new THREE.MeshBasicMaterial({map: loader_load('paper_cutout_3_71859379/assets/minecraft/textures/blocks/grass_side.png')}),
    new THREE.MeshBasicMaterial({map: loader_load('paper_cutout_3_71859379/assets/minecraft/textures/blocks/grass_side.png')}),
  ];

  var size = 10;
  for (var i = -size; i <= size;i++) {
    for (var j = -size; j <= size;j++) {
      cube = new THREE.Mesh(geometry, materials);
      cube.position.set(i, 0, j);
      scene.add(cube);
      objects.push(cube);
    }
  }
}

    </script>
    <style>
html, body {
  height: 100%;
  margin: 0;
}

    </style>
  </body>
</html>